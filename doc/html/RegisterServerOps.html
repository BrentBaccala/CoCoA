<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META NAME="generator" CONTENT="http://txt2tags.sf.net">
<LINK REL="stylesheet" TYPE="text/css" HREF="cocoalib-doc.css">
<TITLE>      RegisterServerOps</TITLE>
</HEAD><BODY BGCOLOR="white" TEXT="black">
<P ALIGN="center"><CENTER><H1>      RegisterServerOps</H1>
<FONT SIZE="4">
<I>      &copy;  2007-2009 Anna Bigatti</I><BR>
      GNU Free Documentation License, Version 1.2
</FONT></CENTER>

<P></P>
<HR NOSHADE SIZE=1>
<P></P>
    <UL>
    <LI><A HREF="#toc1">User documentation</A>
      <UL>
      <LI><A HREF="#toc2">Quick and easy way to add a single operation</A>
      <LI><A HREF="#toc3">Proper way to add a library</A>
      </UL>
    <LI><A HREF="#toc4">Mantainer documentation</A>
    <LI><A HREF="#toc5">Main changes</A>
      <UL>
      <LI><A HREF="#toc6">2009</A>
      </UL>
    </UL>

<P></P>
<HR NOSHADE SIZE=1>
<P></P>
<P>
      <center><a href="index.html">CoCoALib Documentation Index</a></center>
</P>
<A NAME="toc1"></A>
<H2>User documentation</H2>
<A NAME="toc2"></A>
<H3>Quick and easy way to add a single operation</H3>
<P>
When you want to have some operation accessible from CoCoA-4 you need
to make these steps:
</P>
<UL>
<LI>integrate your operation into CoCoALib
 <UL>
 <LI>make <CODE>TmpMyFile.[HC]</CODE>
 <LI>add  <CODE>TmpMyFile.C</CODE> to <CODE>src/AlgebraicCore/Makefile</CODE>
 <LI>add  <CODE>TmpMyFile.H</CODE> to <CODE>include/library.H</CODE>
 </UL>
<LI>make a <CODE>ServerOpBase</CODE> for it in <CODE>RegisterServerOpsUser.C</CODE>
  (see <A HREF="ServerOp.html"><CODE>ServerOp</CODE></A>)
<LI>register it in <CODE>RegisterServerOps.C</CODE> (see below)
</UL>

<P>
Register your ServerOpBase in <CODE>bool RegisterOps()</CODE> at the end of the file:
</P>
<PRE>
   void RegisterOp(const std::string&amp; s, ServerOp o);
</PRE>
<P>
where <CODE>s</CODE> is the "OpenMath name" of the operation for the
communication with CoCoA-4 (used in cocoa5.cpkg).
</P>
<P>
Properly, you need to choose 3 names for your operation:
</P>
<UL>
<LI>the <B>CoCoALib name</B> 
    for the <CODE>ServerOp</CODE> (following the CoCoALib coding conventions)
<LI>the <B>"OpenMath" name</B>
    used only for computer communication
<LI>the <B>CoCoA-4 name</B>
    for the CoCoA-4 user (following the CoCoA-4 conventions and ending
    with a "5" to mean <B>CoCoA-5</B>)
</UL>

<A NAME="toc3"></A>
<H3>Proper way to add a library</H3>
<P>
You should make a dedicated file <CODE>RegisterServerOpsMyOperations.C</CODE>
(see, for example, <CODE>src/AlgebraicCore/RegisterServerOpsFrobby.C</CODE>)
</P>
<P>
Then you should choose a meaningful name for the namespace of your
operations (for example <CODE>CoCoAServerOperationsFromFrobby</CODE>) and
define your own <CODE>RegisterOps</CODE> and copy the function <CODE>RegisterOpsOnce</CODE>:
</P>
<PRE>
    namespace NamespaceForMyOperations
    {
      bool RegisterOps()
      {
        RegisterOp("OpenMathName1", ServerOp(new CoCoALibName1()));
        RegisterOp("OpenMathName2", ServerOp(new CoCoALibName2()));
        ...
        return true;
      }
  
  
      bool RegisterOpsOnce()
      {
        static bool EvalOnce = RegisterOps();
        return EvalOnce;
      }
    }
</PRE>
<P></P>
<P>
Then add in <CODE>src/server/RegisterServerOps.H</CODE> the registration of your
operations simply copying these lines:
</P>
<PRE>
    namespace NamespaceForMyOperations
    {
      bool RegisterOpsOnce();
      bool GlobalDummyVar = RegisterOpsOnce();
    }
</PRE>
<P>
or make a dedicated file <CODE>MyRegisterServerOps.H</CODE>
(see, for example, <CODE>src/server/RegisterServerOpsFrobby.H</CODE>)
and include it in <CODE>src/server/CoCoAServer.C</CODE>
</P>
<A NAME="toc4"></A>
<H2>Mantainer documentation</H2>
<P>
How does this work?  When <CODE>CoCoAServer.C</CODE> is compiled the global
variables are initialized.
</P>
<P>
Therefore <CODE>NamespaceForMyOperations::GlobalDummyVar</CODE> which is
declared in the included file <CODE>RegisterServerOps.H</CODE> is initialized
by calling <CODE>NamespaceForMyOperations::RegisterOpsOnce()</CODE> with the
<I>side effect</I> of registering your operations.
</P>
<A NAME="toc5"></A>
<H2>Main changes</H2>
<A NAME="toc6"></A>
<H3>2009</H3>
<P>
Cleaned up the documentation after integration of the Frobby library.
</P>

<!-- html code generated by txt2tags 2.5 (http://txt2tags.sf.net) -->
<!-- cmdline: txt2tags -t html -o html/RegisterServerOps.html -i txt/RegisterServerOps.txt -->
</BODY></HTML>
